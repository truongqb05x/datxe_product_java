<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RentCar Admin - Quản lý xe</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css">
    <link rel="stylesheet" href="../../css/pages/quanlyxe.css">
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <i class="fas fa-car"></i>
            <h2>RentCar Admin</h2>
        </div>
        
        <ul class="nav-menu">
            <li class="nav-item">
                <a href="dashboard.html" class="nav-link">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
            </li>
            
            <li class="nav-item">
                <a href="#" class="nav-link active">
                    <i class="fas fa-car"></i>
                    <span>Quản lý xe</span>
                </a>
            </li>
            
            <li class="nav-item">
                <a href="bookings.html" class="nav-link">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Đơn đặt xe</span>
                </a>
            </li>
            
            <li class="nav-item">
                <a href="users.html" class="nav-link">
                    <i class="fas fa-users"></i>
                    <span>Người dùng</span>
                </a>
            </li>
            
            <li class="nav-item">
                <a href="reports.html" class="nav-link">
                    <i class="fas fa-chart-bar"></i>
                    <span>Báo cáo</span>
                </a>
            </li>
        </ul>
        
        <div class="sidebar-footer">
            <div class="user-info">
                <div class="user-avatar">A</div>
                <div>
                    <h4>Admin User</h4>
                    <p>Quản trị viên</p>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <header class="header">
            <div class="header-left">
                <h1><i class="fas fa-car"></i> Quản lý xe</h1>
                <p>Quản lý tất cả phương tiện trong hệ thống</p>
            </div>
            
            <div class="header-right">
                <button class="btn btn-primary" id="addVehicleBtn">
                    <i class="fas fa-plus"></i> Thêm xe mới
                </button>
            </div>
        </header>

        <!-- Stats Summary -->
        <div class="stats-summary">
            <div class="stat-item">
                <div class="stat-value" id="totalVehicles">45</div>
                <div class="stat-label">Tổng số xe</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="availableVehicles">38</div>
                <div class="stat-label">Xe có sẵn</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="rentedVehicles">5</div>
                <div class="stat-label">Đang được thuê</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="maintenanceVehicles">2</div>
                <div class="stat-label">Đang bảo trì</div>
            </div>
        </div>

        <!-- Filters Section -->
        <section class="filters-section">
            <h3><i class="fas fa-filter"></i> Bộ lọc</h3>
            <div class="filter-grid">
                <div class="filter-group">
                    <label for="filterCategory">Loại xe</label>
                    <select id="filterCategory">
                        <option value="">Tất cả loại</option>
                        <option value="motorcycle">Xe máy</option>
                        <option value="electric">Xe điện</option>
                        <option value="car">Ô tô</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="filterBrand">Thương hiệu</label>
                    <select id="filterBrand">
                        <option value="">Tất cả thương hiệu</option>
                        <option value="honda">Honda</option>
                        <option value="yamaha">Yamaha</option>
                        <option value="toyota">Toyota</option>
                        <option value="vinfast">Vinfast</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="filterStatus">Trạng thái</label>
                    <select id="filterStatus">
                        <option value="">Tất cả trạng thái</option>
                        <option value="available">Có sẵn</option>
                        <option value="rented">Đang thuê</option>
                        <option value="maintenance">Bảo trì</option>
                        <option value="unavailable">Không khả dụng</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="filterSearch">Tìm kiếm</label>
                    <input type="text" id="filterSearch" placeholder="Biển số, model...">
                </div>
            </div>
            
            <div class="filter-actions">
                <button class="btn btn-primary" id="applyFilters">
                    <i class="fas fa-search"></i> Áp dụng bộ lọc
                </button>
                <button class="btn btn-outline" id="resetFilters">
                    <i class="fas fa-redo"></i> Đặt lại
                </button>
                <button class="btn btn-success" id="exportBtn">
                    <i class="fas fa-file-export"></i> Xuất Excel
                </button>
            </div>
        </section>

        <!-- View Toggle -->
        <div class="view-toggle">
            <button class="view-btn active" id="gridViewBtn">
                <i class="fas fa-th"></i> Grid
            </button>
            <button class="view-btn" id="tableViewBtn">
                <i class="fas fa-list"></i> Table
            </button>
        </div>

        <!-- Vehicles Grid View -->
        <div class="vehicles-grid" id="vehiclesGridView">
            <!-- Vehicle cards will be dynamically generated -->
        </div>

        <!-- Vehicles Table View -->
        <div class="vehicles-table-container" id="vehiclesTableView" style="display: none;">
            <div class="table-toolbar">
                <div class="table-info">
                    Hiển thị <span id="tableCount">10</span> trên tổng số <span id="tableTotal">45</span> xe
                </div>
                <div class="table-actions">
                    <button class="btn btn-outline" id="selectAllBtn">
                        <i class="fas fa-check-square"></i> Chọn tất cả
                    </button>
                    <button class="btn btn-danger" id="deleteSelectedBtn">
                        <i class="fas fa-trash"></i> Xóa đã chọn
                    </button>
                </div>
            </div>
            
            <div class="table-responsive">
                <table id="vehiclesTable">
                    <thead>
                        <tr>
                            <th style="width: 50px;">
                                <input type="checkbox" class="select-checkbox" id="selectAllCheckbox">
                            </th>
                            <th style="width: 80px;">Ảnh</th>
                            <th>Thông tin xe</th>
                            <th>Loại xe</th>
                            <th>Giá thuê</th>
                            <th>Trạng thái</th>
                            <th>Đánh giá</th>
                            <th>Thao tác</th>
                        </tr>
                    </thead>
                    <tbody id="vehiclesTableBody">
                        <!-- Table rows will be dynamically generated -->
                    </tbody>
                </table>
            </div>
            
            <div class="pagination">
                <button class="page-btn"><i class="fas fa-chevron-left"></i></button>
                <button class="page-btn active">1</button>
                <button class="page-btn">2</button>
                <button class="page-btn">3</button>
                <button class="page-btn">4</button>
                <button class="page-btn"><i class="fas fa-chevron-right"></i></button>
            </div>
        </div>

        <!-- Add/Edit Vehicle Modal -->
        <div class="modal" id="vehicleModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalTitle">Thêm xe mới</h3>
                    <button class="close-modal" id="closeModal">&times;</button>
                </div>
                
                <div class="modal-body">
                    <form id="vehicleForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="vehicleLicensePlate">Biển số xe *</label>
                                <input type="text" id="vehicleLicensePlate" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="vehicleBrand">Thương hiệu *</label>
                                <select id="vehicleBrand" required>
                                    <option value="">Chọn thương hiệu</option>
                                    <option value="1">Honda</option>
                                    <option value="2">Yamaha</option>
                                    <option value="3">Toyota</option>
                                    <option value="4">Vinfast</option>
                                    <option value="5">Suzuki</option>
                                    <option value="6">Ford</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="vehicleModel">Model *</label>
                                <input type="text" id="vehicleModel" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="vehicleYear">Năm sản xuất *</label>
                                <select id="vehicleYear" required>
                                    <option value="">Chọn năm</option>
                                    <option value="2023">2023</option>
                                    <option value="2022">2022</option>
                                    <option value="2021">2021</option>
                                    <option value="2020">2020</option>
                                    <option value="2019">2019</option>
                                    <option value="2018">2018</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="vehicleCategory">Loại xe *</label>
                                <select id="vehicleCategory" required>
                                    <option value="">Chọn loại xe</option>
                                    <option value="1">Xe máy</option>
                                    <option value="2">Xe điện</option>
                                    <option value="3">Ô tô</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="vehicleColor">Màu sắc *</label>
                                <input type="text" id="vehicleColor" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="vehicleFuelType">Loại nhiên liệu</label>
                                <select id="vehicleFuelType">
                                    <option value="gasoline">Xăng</option>
                                    <option value="electric">Điện</option>
                                    <option value="diesel">Dầu Diesel</option>
                                    <option value="hybrid">Hybrid</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="vehicleTransmission">Hộp số</label>
                                <select id="vehicleTransmission">
                                    <option value="manual">Số sàn</option>
                                    <option value="automatic">Tự động</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="vehicleEngine">Động cơ</label>
                                <input type="text" id="vehicleEngine" placeholder="110cc, 1.5L...">
                            </div>
                            
                            <div class="form-group">
                                <label for="vehicleSeats">Số chỗ</label>
                                <select id="vehicleSeats">
                                    <option value="1">1 chỗ</option>
                                    <option value="2">2 chỗ</option>
                                    <option value="4">4 chỗ</option>
                                    <option value="5">5 chỗ</option>
                                    <option value="7">7 chỗ</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="vehicleDailyRate">Giá thuê/ngày (VNĐ) *</label>
                                <input type="number" id="vehicleDailyRate" required min="0">
                            </div>
                            
                            <div class="form-group">
                                <label for="vehicleWeeklyRate">Giá thuê/tuần (VNĐ)</label>
                                <input type="number" id="vehicleWeeklyRate" min="0">
                            </div>
                            
                            <div class="form-group">
                                <label for="vehicleMonthlyRate">Giá thuê/tháng (VNĐ)</label>
                                <input type="number" id="vehicleMonthlyRate" min="0">
                            </div>
                            
                            <div class="form-group">
                                <label for="vehicleDeposit">Tiền cọc (VNĐ)</label>
                                <input type="number" id="vehicleDeposit" min="0">
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="vehicleDescription">Mô tả</label>
                                <textarea id="vehicleDescription" rows="3"></textarea>
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="vehicleSpecifications">Thông số kỹ thuật (JSON)</label>
                                <textarea id="vehicleSpecifications" rows="3" placeholder='{"max_speed": "120km/h", "fuel_capacity": "4L"}'></textarea>
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="vehicleAmenities">Tiện nghi</label>
                                <div class="form-row">
                                    <label style="display: flex; align-items: center; gap: 5px;">
                                        <input type="checkbox" name="amenities" value="air_conditioner"> Điều hòa
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 5px;">
                                        <input type="checkbox" name="amenities" value="reverse_camera"> Camera lùi
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 5px;">
                                        <input type="checkbox" name="amenities" value="gps"> GPS
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 5px;">
                                        <input type="checkbox" name="amenities" value="bluetooth"> Bluetooth
                                    </label>
                                </div>
                            </div>
                            
                            <div class="form-group full-width">
                                <label>Hình ảnh xe</label>
                                <div class="image-upload" id="imageUpload">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <p>Kéo thả hình ảnh vào đây hoặc click để chọn</p>
                                    <p><small>Định dạng hỗ trợ: JPG, PNG, GIF. Tối đa 5MB mỗi ảnh</small></p>
                                    <input type="file" id="imageInput" multiple accept="image/*" style="display: none;">
                                </div>
                                <div class="image-preview" id="imagePreview"></div>
                            </div>
                            
                            <div class="form-group">
                                <label for="vehicleStatus">Trạng thái</label>
                                <select id="vehicleStatus">
                                    <option value="available">Có sẵn</option>
                                    <option value="rented">Đang thuê</option>
                                    <option value="maintenance">Bảo trì</option>
                                    <option value="unavailable">Không khả dụng</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="vehicleFeatured">Nổi bật</label>
                                <select id="vehicleFeatured">
                                    <option value="0">Không</option>
                                    <option value="1">Có</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="vehicleLocation">Vị trí hiện tại</label>
                                <input type="text" id="vehicleLocation" placeholder="Địa chỉ">
                            </div>
                        </div>
                    </form>
                </div>
                
                <div class="modal-footer">
                    <button class="btn btn-outline" id="cancelModal">Hủy</button>
                    <button class="btn btn-primary" id="saveVehicle">Lưu thông tin</button>
                </div>
            </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div class="modal" id="deleteModal">
            <div class="modal-content" style="max-width: 400px;">
                <div class="modal-header">
                    <h3><i class="fas fa-exclamation-triangle"></i> Xác nhận xóa</h3>
                    <button class="close-modal" id="closeDeleteModal">&times;</button>
                </div>
                <div class="modal-body">
                    <p id="deleteMessage">Bạn có chắc chắn muốn xóa xe này?</p>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-outline" id="cancelDelete">Hủy</button>
                    <button class="btn btn-danger" id="confirmDelete">Xóa</button>
                </div>
            </div>
        </div>

        <!-- Vehicle Detail Modal -->
        <div class="modal" id="detailModal">
            <div class="modal-content" style="max-width: 900px;">
                <div class="modal-header">
                    <h3 id="detailVehicleName">Toyota Vios 2023</h3>
                    <button class="close-modal" id="closeDetailModal">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="detailContent">
                        <!-- Detail content will be loaded dynamically -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-outline" id="closeDetail">Đóng</button>
                    <button class="btn btn-primary" id="editDetail">Chỉnh sửa</button>
                </div>
            </div>
        </div>
    </main>

    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        // Mock data for vehicles
        const mockVehicles = [
            {
                id: 1,
                license_plate: "51A-12345",
                brand: "Toyota",
                model: "Vios",
                year: 2023,
                category: "Ô tô",
                color: "Trắng",
                fuel_type: "Xăng",
                transmission: "Số sàn",
                engine: "1.5L",
                seats: 5,
                daily_rate: 600000,
                weekly_rate: 3500000,
                monthly_rate: 12000000,
                deposit: 5000000,
                status: "available",
                featured: true,
                rating: 4.8,
                reviews: 156,
                total_rentals: 28,
                description: "Toyota Vios 2023 mới, tiết kiệm nhiên liệu, nội thất sang trọng",
                image: "https://images.unsplash.com/photo-1549317661-bd32c8ce0db2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80",
                location: "123 Đường ABC, Quận 1, TP.HCM"
            },
            {
                id: 2,
                license_plate: "51B-67890",
                brand: "Honda",
                model: "Vision",
                year: 2023,
                category: "Xe máy",
                color: "Đen",
                fuel_type: "Xăng",
                transmission: "Tự động",
                engine: "110cc",
                seats: 2,
                daily_rate: 150000,
                weekly_rate: 900000,
                monthly_rate: 3000000,
                deposit: 1000000,
                status: "available",
                featured: true,
                rating: 4.5,
                reviews: 128,
                total_rentals: 45,
                description: "Honda Vision 2023, xe ga tự động, tiết kiệm xăng",
                image: "https://images.unsplash.com/photo-1609630875171-b1321377ee65?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1480&q=80",
                location: "456 Đường XYZ, Quận 3, TP.HCM"
            },
            {
                id: 3,
                license_plate: "51C-11223",
                brand: "Yamaha",
                model: "Exciter",
                year: 2023,
                category: "Xe máy",
                color: "Xanh",
                fuel_type: "Xăng",
                transmission: "Số sàn",
                engine: "150cc",
                seats: 2,
                daily_rate: 180000,
                weekly_rate: 1000000,
                monthly_rate: 3500000,
                deposit: 1200000,
                status: "rented",
                featured: true,
                rating: 4.7,
                reviews: 167,
                total_rentals: 32,
                description: "Yamaha Exciter 2023, xe thể thao, động cơ mạnh mẽ",
                image: "https://images.unsplash.com/photo-1621007947382-bb3c3994e3fb?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80",
                location: "789 Đường LMN, Quận Bình Thạnh, TP.HCM"
            },
            {
                id: 4,
                license_plate: "51D-44556",
                brand: "Vinfast",
                model: "Klara",
                year: 2023,
                category: "Xe điện",
                color: "Trắng",
                fuel_type: "Điện",
                transmission: "Tự động",
                engine: "1.2kW",
                seats: 2,
                daily_rate: 120000,
                weekly_rate: 700000,
                monthly_rate: 2500000,
                deposit: 800000,
                status: "maintenance",
                featured: false,
                rating: 4.0,
                reviews: 96,
                total_rentals: 19,
                description: "Vinfast Klara S, xe điện thông minh, thân thiện môi trường",
                image: "https://images.unsplash.com/photo-1571068316344-75bc76f77890?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80",
                location: "321 Đường PQR, Quận Tân Bình, TP.HCM"
            },
            {
                id: 5,
                license_plate: "51E-77889",
                brand: "Honda",
                model: "Wave",
                year: 2022,
                category: "Xe máy",
                color: "Đỏ",
                fuel_type: "Xăng",
                transmission: "Số sàn",
                engine: "110cc",
                seats: 2,
                daily_rate: 100000,
                weekly_rate: 600000,
                monthly_rate: 2000000,
                deposit: 500000,
                status: "available",
                featured: false,
                rating: 4.3,
                reviews: 205,
                total_rentals: 38,
                description: "Honda Wave 2022, xe số bền bỉ, tiết kiệm nhiên liệu",
                image: "https://images.unsplash.com/photo-1558618047-3c8c76ca7d13?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80",
                location: "654 Đường UVW, Quận Phú Nhuận, TP.HCM"
            },
            {
                id: 6,
                license_plate: "51F-99001",
                brand: "Toyota",
                model: "Innova",
                year: 2022,
                category: "Ô tô",
                color: "Bạc",
                fuel_type: "Dầu Diesel",
                transmission: "Tự động",
                engine: "2.4L",
                seats: 7,
                daily_rate: 800000,
                weekly_rate: 4500000,
                monthly_rate: 15000000,
                deposit: 8000000,
                status: "available",
                featured: true,
                rating: 4.6,
                reviews: 89,
                total_rentals: 15,
                description: "Toyota Innova 2022, xe 7 chỗ, phù hợp gia đình",
                image: "https://images.unsplash.com/photo-1549399542-7e3f8b79c341?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80",
                location: "987 Đường XYZ, Quận 2, TP.HCM"
            },
            {
                id: 7,
                license_plate: "51G-22334",
                brand: "Vinfast",
                model: "Fadil",
                year: 2023,
                category: "Ô tô",
                color: "Xanh",
                fuel_type: "Xăng",
                transmission: "Tự động",
                engine: "1.4L",
                seats: 5,
                daily_rate: 500000,
                weekly_rate: 2800000,
                monthly_rate: 10000000,
                deposit: 4000000,
                status: "rented",
                featured: false,
                rating: 4.2,
                reviews: 67,
                total_rentals: 12,
                description: "Vinfast Fadil 2023, xe hạng A, tiết kiệm nhiên liệu",
                image: "https://images.unsplash.com/photo-1503376780353-7e6692767b70?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80",
                location: "159 Đường ABC, Quận 10, TP.HCM"
            },
            {
                id: 8,
                license_plate: "51H-55667",
                brand: "Suzuki",
                model: "Ciaz",
                year: 2022,
                category: "Ô tô",
                color: "Đen",
                fuel_type: "Xăng",
                transmission: "Tự động",
                engine: "1.4L",
                seats: 5,
                daily_rate: 550000,
                weekly_rate: 3000000,
                monthly_rate: 11000000,
                deposit: 4500000,
                status: "unavailable",
                featured: false,
                rating: 4.4,
                reviews: 78,
                total_rentals: 21,
                description: "Suzuki Ciaz 2022, sedan hạng B, nội thất rộng rãi",
                image: "https://images.unsplash.com/photo-1533473359331-0135ef1b58bf?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80",
                location: "753 Đường DEF, Quận Gò Vấp, TP.HCM"
            }
        ];

        // DOM Elements
        const vehiclesGridView = document.getElementById('vehiclesGridView');
        const vehiclesTableView = document.getElementById('vehiclesTableView');
        const vehiclesTableBody = document.getElementById('vehiclesTableBody');
        const gridViewBtn = document.getElementById('gridViewBtn');
        const tableViewBtn = document.getElementById('tableViewBtn');
        const addVehicleBtn = document.getElementById('addVehicleBtn');
        const vehicleModal = document.getElementById('vehicleModal');
        const deleteModal = document.getElementById('deleteModal');
        const detailModal = document.getElementById('detailModal');
        const vehicleForm = document.getElementById('vehicleForm');
        const imageUpload = document.getElementById('imageUpload');
        const imageInput = document.getElementById('imageInput');
        const imagePreview = document.getElementById('imagePreview');
        let currentVehicleId = null;
        let selectedVehicles = new Set();

        // Initialize Select2
        $(document).ready(function() {
            $('#vehicleBrand, #vehicleCategory, #vehicleYear').select2({
                width: '100%',
                placeholder: 'Chọn...'
            });
        });

        // Format currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN', { 
                style: 'currency', 
                currency: 'VND' 
            }).format(amount);
        }

        // Get status badge
        function getStatusBadge(status) {
            const badges = {
                'available': '<span class="status-badge status-available">Có sẵn</span>',
                'rented': '<span class="status-badge status-rented">Đang thuê</span>',
                'maintenance': '<span class="status-badge status-maintenance">Bảo trì</span>',
                'unavailable': '<span class="status-badge status-unavailable">Không khả dụng</span>'
            };
            return badges[status] || badges['unavailable'];
        }

        // Get status text
        function getStatusText(status) {
            const texts = {
                'available': 'Có sẵn',
                'rented': 'Đang thuê',
                'maintenance': 'Bảo trì',
                'unavailable': 'Không khả dụng'
            };
            return texts[status] || 'Không xác định';
        }

        // Generate star rating HTML
        function generateStars(rating) {
            let stars = '';
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            
            for (let i = 0; i < 5; i++) {
                if (i < fullStars) {
                    stars += '<i class="fas fa-star" style="color: #f39c12;"></i>';
                } else if (i === fullStars && hasHalfStar) {
                    stars += '<i class="fas fa-star-half-alt" style="color: #f39c12;"></i>';
                } else {
                    stars += '<i class="far fa-star" style="color: #ccc;"></i>';
                }
            }
            return stars;
        }

        // Render vehicles grid view
        function renderGridView(vehicles = mockVehicles) {
            vehiclesGridView.innerHTML = '';
            
            vehicles.forEach(vehicle => {
                const card = document.createElement('div');
                card.className = 'vehicle-card-grid';
                card.innerHTML = `
                    <div class="vehicle-card-header">
                        <img src="${vehicle.image}" alt="${vehicle.brand} ${vehicle.model}">
                        ${getStatusBadge(vehicle.status)}
                    </div>
                    <div class="vehicle-card-body">
                        <div class="vehicle-title">
                            <h4>${vehicle.brand} ${vehicle.model} ${vehicle.year}</h4>
                            <div class="vehicle-price">${formatCurrency(vehicle.daily_rate)}<small>/ngày</small></div>
                        </div>
                        <div class="vehicle-details">
                            <div class="vehicle-detail">
                                <i class="fas fa-tag"></i> ${vehicle.license_plate}
                            </div>
                            <div class="vehicle-detail">
                                <i class="fas fa-gas-pump"></i> ${vehicle.fuel_type}
                            </div>
                            <div class="vehicle-detail">
                                <i class="fas fa-user"></i> ${vehicle.seats} chỗ
                            </div>
                        </div>
                        <div class="vehicle-rating">
                            ${generateStars(vehicle.rating)}
                            <span>${vehicle.rating.toFixed(1)} (${vehicle.reviews})</span>
                        </div>
                        <p style="font-size: 0.9rem; color: #666; margin: 0.5rem 0;">${vehicle.description.substring(0, 60)}...</p>
                        <div class="vehicle-stats">
                            <div class="stat">
                                <i class="fas fa-calendar-check"></i> ${vehicle.total_rentals} lần thuê
                            </div>
                            <div class="stat">
                                <i class="fas fa-map-marker-alt"></i> ${vehicle.location.split(',')[0]}
                            </div>
                        </div>
                        <div class="vehicle-actions">
                            <button class="btn btn-outline view-detail" data-id="${vehicle.id}">
                                <i class="fas fa-eye"></i> Xem
                            </button>
                            <button class="btn btn-primary edit-vehicle" data-id="${vehicle.id}">
                                <i class="fas fa-edit"></i> Sửa
                            </button>
                            <button class="btn btn-danger delete-vehicle" data-id="${vehicle.id}">
                                <i class="fas fa-trash"></i> Xóa
                            </button>
                        </div>
                    </div>
                `;
                vehiclesGridView.appendChild(card);
            });
            
            // Add event listeners
            document.querySelectorAll('.view-detail').forEach(btn => {
                btn.addEventListener('click', () => viewVehicleDetail(btn.dataset.id));
            });
            
            document.querySelectorAll('.edit-vehicle').forEach(btn => {
                btn.addEventListener('click', () => editVehicle(btn.dataset.id));
            });
            
            document.querySelectorAll('.delete-vehicle').forEach(btn => {
                btn.addEventListener('click', () => confirmDeleteVehicle(btn.dataset.id));
            });
        }

        // Render vehicles table view
        function renderTableView(vehicles = mockVehicles) {
            vehiclesTableBody.innerHTML = '';
            
            vehicles.forEach(vehicle => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <input type="checkbox" class="select-checkbox select-vehicle" data-id="${vehicle.id}">
                    </td>
                    <td>
                        <img src="${vehicle.image}" class="vehicle-thumb" alt="${vehicle.brand} ${vehicle.model}">
                    </td>
                    <td>
                        <div style="font-weight: 600;">${vehicle.brand} ${vehicle.model} ${vehicle.year}</div>
                        <div style="font-size: 0.8rem; color: #666;">${vehicle.license_plate}</div>
                        <div style="font-size: 0.8rem;">${vehicle.color} • ${vehicle.seats} chỗ</div>
                    </td>
                    <td>${vehicle.category}</td>
                    <td>
                        <div style="font-weight: 600; color: var(--secondary);">${formatCurrency(vehicle.daily_rate)}</div>
                        <div style="font-size: 0.8rem; color: #666;">/ngày</div>
                    </td>
                    <td>${getStatusBadge(vehicle.status)}</td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 5px;">
                            ${generateStars(vehicle.rating)}
                            <span style="font-size: 0.8rem;">${vehicle.rating.toFixed(1)}</span>
                        </div>
                        <div style="font-size: 0.8rem; color: #666;">${vehicle.reviews} đánh giá</div>
                    </td>
                    <td>
                        <div style="display: flex; gap: 5px;">
                            <button class="action-btn view-detail" data-id="${vehicle.id}" title="Xem chi tiết">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="action-btn edit-vehicle" data-id="${vehicle.id}" title="Chỉnh sửa">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete-vehicle" data-id="${vehicle.id}" title="Xóa">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                vehiclesTableBody.appendChild(row);
            });
            
            // Add event listeners
            document.querySelectorAll('.select-vehicle').forEach(checkbox => {
                checkbox.addEventListener('change', (e) => {
                    const id = parseInt(e.target.dataset.id);
                    if (e.target.checked) {
                        selectedVehicles.add(id);
                    } else {
                        selectedVehicles.delete(id);
                    }
                    updateSelectedCount();
                });
            });
            
            document.querySelectorAll('.view-detail').forEach(btn => {
                btn.addEventListener('click', () => viewVehicleDetail(btn.dataset.id));
            });
            
            document.querySelectorAll('.edit-vehicle').forEach(btn => {
                btn.addEventListener('click', () => editVehicle(btn.dataset.id));
            });
            
            document.querySelectorAll('.delete-vehicle').forEach(btn => {
                btn.addEventListener('click', () => confirmDeleteVehicle(btn.dataset.id));
            });
            
            // Update counts
            document.getElementById('tableCount').textContent = vehicles.length;
            document.getElementById('tableTotal').textContent = mockVehicles.length;
        }

        // Update selected count
        function updateSelectedCount() {
            const deleteBtn = document.getElementById('deleteSelectedBtn');
            if (selectedVehicles.size > 0) {
                deleteBtn.textContent = `Xóa (${selectedVehicles.size})`;
            } else {
                deleteBtn.textContent = 'Xóa đã chọn';
            }
        }

        // View vehicle details
        function viewVehicleDetail(id) {
            const vehicle = mockVehicles.find(v => v.id === parseInt(id));
            if (!vehicle) return;
            
            currentVehicleId = vehicle.id;
            
            document.getElementById('detailVehicleName').textContent = `${vehicle.brand} ${vehicle.model} ${vehicle.year}`;
            
            document.getElementById('detailContent').innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                    <div>
                        <img src="${vehicle.image}" alt="${vehicle.brand} ${vehicle.model}" style="width: 100%; border-radius: 8px; margin-bottom: 1rem;">
                        
                        <h4 style="color: var(--primary); margin-bottom: 1rem; border-bottom: 2px solid var(--secondary); padding-bottom: 0.5rem;">Thông tin cơ bản</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 1rem;">
                            <div><strong>Biển số:</strong> ${vehicle.license_plate}</div>
                            <div><strong>Màu sắc:</strong> ${vehicle.color}</div>
                            <div><strong>Năm SX:</strong> ${vehicle.year}</div>
                            <div><strong>Loại xe:</strong> ${vehicle.category}</div>
                            <div><strong>Nhiên liệu:</strong> ${vehicle.fuel_type}</div>
                            <div><strong>Hộp số:</strong> ${vehicle.transmission}</div>
                            <div><strong>Động cơ:</strong> ${vehicle.engine}</div>
                            <div><strong>Số chỗ:</strong> ${vehicle.seats}</div>
                        </div>
                        
                        <h4 style="color: var(--primary); margin-bottom: 1rem; border-bottom: 2px solid var(--secondary); padding-bottom: 0.5rem;">Đánh giá</h4>
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                            <div style="font-size: 2rem; font-weight: bold; color: var(--secondary);">${vehicle.rating.toFixed(1)}</div>
                            <div>
                                <div>${generateStars(vehicle.rating)}</div>
                                <div style="font-size: 0.9rem; color: #666;">${vehicle.reviews} đánh giá • ${vehicle.total_rentals} lần thuê</div>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h4 style="color: var(--primary); margin-bottom: 1rem; border-bottom: 2px solid var(--secondary); padding-bottom: 0.5rem;">Thông tin giá</h4>
                        <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Giá thuê theo ngày:</span>
                                <span style="font-weight: bold; color: var(--secondary);">${formatCurrency(vehicle.daily_rate)}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Giá thuê theo tuần:</span>
                                <span style="font-weight: bold;">${formatCurrency(vehicle.weekly_rate)}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Giá thuê theo tháng:</span>
                                <span style="font-weight: bold;">${formatCurrency(vehicle.monthly_rate)}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; border-top: 1px solid #ddd; padding-top: 0.5rem; margin-top: 0.5rem;">
                                <span>Tiền cọc:</span>
                                <span style="font-weight: bold; color: var(--warning);">${formatCurrency(vehicle.deposit)}</span>
                            </div>
                        </div>
                        
                        <h4 style="color: var(--primary); margin-bottom: 1rem; border-bottom: 2px solid var(--secondary); padding-bottom: 0.5rem;">Trạng thái & Vị trí</h4>
                        <div style="margin-bottom: 1rem;">
                            <div style="margin-bottom: 0.5rem;">
                                <strong>Trạng thái:</strong> ${getStatusBadge(vehicle.status)}
                            </div>
                            <div>
                                <strong>Vị trí hiện tại:</strong>
                                <div style="background: #f8f9fa; padding: 0.8rem; border-radius: 4px; margin-top: 0.3rem;">
                                    <i class="fas fa-map-marker-alt"></i> ${vehicle.location}
                                </div>
                            </div>
                        </div>
                        
                        <h4 style="color: var(--primary); margin-bottom: 1rem; border-bottom: 2px solid var(--secondary); padding-bottom: 0.5rem;">Mô tả</h4>
                        <p style="color: #666; line-height: 1.6;">${vehicle.description}</p>
                    </div>
                </div>
            `;
            
            detailModal.classList.add('active');
        }

        // Open modal for adding new vehicle
        function addNewVehicle() {
            currentVehicleId = null;
            document.getElementById('modalTitle').textContent = 'Thêm xe mới';
            vehicleForm.reset();
            imagePreview.innerHTML = '';
            
            // Set default values
            document.getElementById('vehicleStatus').value = 'available';
            document.getElementById('vehicleFeatured').value = '0';
            $('#vehicleBrand, #vehicleCategory, #vehicleYear').val(null).trigger('change');
            
            vehicleModal.classList.add('active');
        }

        // Edit vehicle
        function editVehicle(id) {
            const vehicle = mockVehicles.find(v => v.id === parseInt(id));
            if (!vehicle) return;
            
            currentVehicleId = vehicle.id;
            document.getElementById('modalTitle').textContent = `Chỉnh sửa: ${vehicle.brand} ${vehicle.model}`;
            
            // Fill form with vehicle data
            document.getElementById('vehicleLicensePlate').value = vehicle.license_plate;
            document.getElementById('vehicleModel').value = vehicle.model;
            document.getElementById('vehicleColor').value = vehicle.color;
            document.getElementById('vehicleFuelType').value = vehicle.fuel_type.toLowerCase();
            document.getElementById('vehicleTransmission').value = vehicle.transmission === 'Số sàn' ? 'manual' : 'automatic';
            document.getElementById('vehicleEngine').value = vehicle.engine;
            document.getElementById('vehicleSeats').value = vehicle.seats;
            document.getElementById('vehicleDailyRate').value = vehicle.daily_rate;
            document.getElementById('vehicleWeeklyRate').value = vehicle.weekly_rate;
            document.getElementById('vehicleMonthlyRate').value = vehicle.monthly_rate;
            document.getElementById('vehicleDeposit').value = vehicle.deposit;
            document.getElementById('vehicleDescription').value = vehicle.description;
            document.getElementById('vehicleLocation').value = vehicle.location;
            document.getElementById('vehicleStatus').value = vehicle.status;
            document.getElementById('vehicleFeatured').value = vehicle.featured ? '1' : '0';
            
            // Set Select2 values
            $('#vehicleBrand').val(vehicle.brand.toLowerCase()).trigger('change');
            $('#vehicleCategory').val(vehicle.category === 'Ô tô' ? '3' : vehicle.category === 'Xe điện' ? '2' : '1').trigger('change');
            $('#vehicleYear').val(vehicle.year.toString()).trigger('change');
            
            // Clear and set image preview
            imagePreview.innerHTML = `
                <div class="preview-image">
                    <img src="${vehicle.image}" alt="Vehicle Image">
                    <button type="button" class="remove-image" onclick="this.parentElement.remove()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            vehicleModal.classList.add('active');
        }

        // Confirm delete vehicle
        function confirmDeleteVehicle(id) {
            const vehicle = mockVehicles.find(v => v.id === parseInt(id));
            if (!vehicle) return;
            
            currentVehicleId = vehicle.id;
            document.getElementById('deleteMessage').textContent = 
                `Bạn có chắc chắn muốn xóa xe "${vehicle.brand} ${vehicle.model} (${vehicle.license_plate})"? Hành động này không thể hoàn tác.`;
            
            deleteModal.classList.add('active');
        }

        // Delete vehicle
        function deleteVehicle() {
            // In real app, this would make API call to delete
            alert(`Xóa xe thành công! (ID: ${currentVehicleId})`);
            
            // Remove from selected vehicles if present
            selectedVehicles.delete(currentVehicleId);
            updateSelectedCount();
            
            // Refresh views
            renderGridView();
            renderTableView();
            
            deleteModal.classList.remove('active');
            updateStats();
        }

        // Delete selected vehicles
        function deleteSelectedVehicles() {
            if (selectedVehicles.size === 0) {
                alert('Vui lòng chọn ít nhất một xe để xóa.');
                return;
            }
            
            if (confirm(`Bạn có chắc chắn muốn xóa ${selectedVehicles.size} xe đã chọn?`)) {
                // In real app, this would make API call to delete multiple
                alert(`Đã xóa ${selectedVehicles.size} xe thành công!`);
                
                selectedVehicles.clear();
                updateSelectedCount();
                
                // Refresh views
                renderGridView();
                renderTableView();
                
                updateStats();
            }
        }

        // Save vehicle (add or update)
        function saveVehicle() {
            if (!vehicleForm.checkValidity()) {
                alert('Vui lòng điền đầy đủ thông tin bắt buộc (*)');
                return;
            }
            
            const formData = {
                license_plate: document.getElementById('vehicleLicensePlate').value,
                brand: $('#vehicleBrand').val(),
                model: document.getElementById('vehicleModel').value,
                year: parseInt($('#vehicleYear').val()),
                category: $('#vehicleCategory').val(),
                color: document.getElementById('vehicleColor').value,
                fuel_type: document.getElementById('vehicleFuelType').value,
                transmission: document.getElementById('vehicleTransmission').value,
                engine: document.getElementById('vehicleEngine').value,
                seats: parseInt(document.getElementById('vehicleSeats').value),
                daily_rate: parseInt(document.getElementById('vehicleDailyRate').value),
                weekly_rate: parseInt(document.getElementById('vehicleWeeklyRate').value) || 0,
                monthly_rate: parseInt(document.getElementById('vehicleMonthlyRate').value) || 0,
                deposit: parseInt(document.getElementById('vehicleDeposit').value) || 0,
                description: document.getElementById('vehicleDescription').value,
                location: document.getElementById('vehicleLocation').value,
                status: document.getElementById('vehicleStatus').value,
                featured: document.getElementById('vehicleFeatured').value === '1'
            };
            
            if (currentVehicleId) {
                // Update existing vehicle
                alert(`Cập nhật xe thành công! (ID: ${currentVehicleId})`);
            } else {
                // Add new vehicle
                alert('Thêm xe mới thành công!');
            }
            
            vehicleModal.classList.remove('active');
            
            // Refresh views
            renderGridView();
            renderTableView();
            
            updateStats();
        }

        // Update statistics
        function updateStats() {
            const total = mockVehicles.length;
            const available = mockVehicles.filter(v => v.status === 'available').length;
            const rented = mockVehicles.filter(v => v.status === 'rented').length;
            const maintenance = mockVehicles.filter(v => v.status === 'maintenance').length;
            
            document.getElementById('totalVehicles').textContent = total;
            document.getElementById('availableVehicles').textContent = available;
            document.getElementById('rentedVehicles').textContent = rented;
            document.getElementById('maintenanceVehicles').textContent = maintenance;
        }

        // Filter vehicles
        function filterVehicles() {
            const category = document.getElementById('filterCategory').value;
            const brand = document.getElementById('filterBrand').value;
            const status = document.getElementById('filterStatus').value;
            const search = document.getElementById('filterSearch').value.toLowerCase();
            
            let filtered = mockVehicles;
            
            if (category) {
                const categoryMap = {
                    'motorcycle': 'Xe máy',
                    'electric': 'Xe điện',
                    'car': 'Ô tô'
                };
                filtered = filtered.filter(v => v.category === categoryMap[category]);
            }
            
            if (brand) {
                filtered = filtered.filter(v => v.brand.toLowerCase() === brand);
            }
            
            if (status) {
                filtered = filtered.filter(v => v.status === status);
            }
            
            if (search) {
                filtered = filtered.filter(v => 
                    v.license_plate.toLowerCase().includes(search) ||
                    v.model.toLowerCase().includes(search) ||
                    v.brand.toLowerCase().includes(search)
                );
            }
            
            renderGridView(filtered);
            renderTableView(filtered);
            
            document.getElementById('tableCount').textContent = filtered.length;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize views
            renderGridView();
            renderTableView();
            updateStats();
            
            // View toggle
            gridViewBtn.addEventListener('click', () => {
                gridViewBtn.classList.add('active');
                tableViewBtn.classList.remove('active');
                vehiclesGridView.style.display = 'grid';
                vehiclesTableView.style.display = 'none';
            });
            
            tableViewBtn.addEventListener('click', () => {
                tableViewBtn.classList.add('active');
                gridViewBtn.classList.remove('active');
                vehiclesGridView.style.display = 'none';
                vehiclesTableView.style.display = 'block';
            });
            
            // Add vehicle button
            addVehicleBtn.addEventListener('click', addNewVehicle);
            
            // Image upload
            imageUpload.addEventListener('click', () => imageInput.click());
            imageInput.addEventListener('change', function(e) {
                const files = Array.from(e.target.files);
                files.forEach(file => {
                    if (file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const preview = document.createElement('div');
                            preview.className = 'preview-image';
                            preview.innerHTML = `
                                <img src="${e.target.result}" alt="Preview">
                                <button type="button" class="remove-image" onclick="this.parentElement.remove()">
                                    <i class="fas fa-times"></i>
                                </button>
                            `;
                            imagePreview.appendChild(preview);
                        };
                        reader.readAsDataURL(file);
                    }
                });
            });
            
            // Modal close buttons
            document.getElementById('closeModal').addEventListener('click', () => {
                vehicleModal.classList.remove('active');
            });
            
            document.getElementById('cancelModal').addEventListener('click', () => {
                vehicleModal.classList.remove('active');
            });
            
            document.getElementById('closeDeleteModal').addEventListener('click', () => {
                deleteModal.classList.remove('active');
            });
            
            document.getElementById('cancelDelete').addEventListener('click', () => {
                deleteModal.classList.remove('active');
            });
            
            document.getElementById('closeDetailModal').addEventListener('click', () => {
                detailModal.classList.remove('active');
            });
            
            document.getElementById('closeDetail').addEventListener('click', () => {
                detailModal.classList.remove('active');
            });
            
            // Action buttons
            document.getElementById('saveVehicle').addEventListener('click', saveVehicle);
            document.getElementById('confirmDelete').addEventListener('click', deleteVehicle);
            document.getElementById('deleteSelectedBtn').addEventListener('click', deleteSelectedVehicles);
            document.getElementById('selectAllBtn').addEventListener('click', () => {
                const checkboxes = document.querySelectorAll('.select-vehicle');
                const allChecked = Array.from(checkboxes).every(cb => cb.checked);
                
                checkboxes.forEach(cb => {
                    cb.checked = !allChecked;
                    const id = parseInt(cb.dataset.id);
                    if (!allChecked) {
                        selectedVehicles.add(id);
                    } else {
                        selectedVehicles.delete(id);
                    }
                });
                
                updateSelectedCount();
            });
            
            // Filter buttons
            document.getElementById('applyFilters').addEventListener('click', filterVehicles);
            document.getElementById('resetFilters').addEventListener('click', () => {
                document.getElementById('filterCategory').value = '';
                document.getElementById('filterBrand').value = '';
                document.getElementById('filterStatus').value = '';
                document.getElementById('filterSearch').value = '';
                renderGridView();
                renderTableView();
            });
            
            document.getElementById('exportBtn').addEventListener('click', () => {
                alert('Xuất file Excel thành công!');
            });
            
            // Edit from detail modal
            document.getElementById('editDetail').addEventListener('click', () => {
                if (currentVehicleId) {
                    detailModal.classList.remove('active');
                    editVehicle(currentVehicleId);
                }
            });
            
            // Close modals when clicking outside
            [vehicleModal, deleteModal, detailModal].forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('active');
                    }
                });
            });
        });
    </script>
</body>
</html>